<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SERVICE 서비스 서버 API</title>
<style>
  :root{
    --bg:#0f172a;           /* slate-900 */
    --panel:#0b1224;        /* darker */
    --ink:#e2e8f0;          /* slate-200 */
    --muted:#94a3b8;        /* slate-400 */
    --accent:#60a5fa;       /* blue-400 */
    --green:#22c55e;
    --yellow:#fbbf24;
    --red:#f87171;
    --purple:#a78bfa;
    --border:#1f2937;
    --chip:#111827;
  }
  html,body{height:100%}
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
       background:linear-gradient(180deg,var(--bg),#0b1020); color:var(--ink);}
  a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}
  .wrap{max-width:1100px;margin:0 auto;padding:2rem 1rem 6rem}
  header{position:sticky;top:0;background:rgba(11,16,32,.85);backdrop-filter:blur(8px);border-bottom:1px solid var(--border);z-index:20}
  header .inner{max-width:1100px;margin:0 auto;display:flex;gap:1rem;align-items:center;padding:0.8rem 1rem}
  .title{font-weight:700;font-size:1.15rem}
  .badge{display:inline-flex;align-items:center;gap:.35rem;padding:.15rem .5rem;border-radius:999px;border:1px solid var(--border);background:var(--chip);font-size:.8rem;color:var(--muted)}
  .btn{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem .8rem;border-radius:.6rem;border:1px solid var(--border);background:#0b1224;color:var(--ink);cursor:pointer}
  .btn:hover{border-color:#334155}
  .grid{display:grid;grid-template-columns:1fr;gap:1rem}
  @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
  .card{background:#0b1224;border:1px solid var(--border);border-radius:14px;padding:1rem}
  h1{font-size:1.9rem;margin:.4rem 0 0}
  h2{font-size:1.3rem;margin:1.2rem 0 .6rem}
  h3{font-size:1.05rem;margin:1rem 0 .4rem;color:var(--muted)}
  code,kbd,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
  pre{background:#0a0f1d;border:1px solid var(--border);padding:1rem;border-radius:12px;overflow:auto}
  table{width:100%;border-collapse:collapse;border:1px solid var(--border);background:#0b1224}
  th,td{border-top:1px solid var(--border);padding:.5rem .6rem;vertical-align:top}
  th{color:#cbd5e1;text-align:left;background:#0a1328;position:sticky;top:0}
  .method{font-weight:700;padding:.2rem .55rem;border-radius:.5rem;font-size:.78rem;border:1px solid var(--border)}
  .GET{color:#10b981;border-color:#065f46;background:rgba(16,185,129,.08)}
  .POST{color:#60a5fa;border-color:#1e3a8a;background:rgba(59,130,246,.08)}
  .PUT{color:#fbbf24;border-color:#92400e;background:rgba(251,191,36,.08)}
  .DELETE{color:#f87171;border-color:#7f1d1d;background:rgba(248,113,113,.08)}
  .tag{display:inline-block;margin-right:.35rem;margin-bottom:.35rem;padding:.15rem .45rem;border-radius:.4rem;background:#0d1428;border:1px solid var(--border);color:#c7d2fe}
  .kv{color:var(--muted)}
  details{border:1px solid var(--border);border-radius:12px;background:#0b1224}
  details>summary{cursor:pointer;list-style:none;padding:.8rem 1rem;font-weight:600}
  details>summary::-webkit-details-marker{display:none}
  details .content{padding:0 1rem 1rem}
  .pill{padding:.15rem .4rem;border:1px solid var(--border);border-radius:.5rem;font-size:.75rem;color:#cbd5e1;background:#0a1320}
  .mono{font-family:ui-monospace,Menlo,Monaco,Consolas,monospace}
  .foot{margin-top:2rem;color:var(--muted);font-size:.9rem}
</style>
<script>
  // Tiny helper to copy JSON/YAML blocks
  function copyText(id){
    const el=document.getElementById(id);
    if(!el) return;
    const r=document.createRange();
    r.selectNode(el);
    const sel=window.getSelection();
    sel.removeAllRanges();
    sel.addRange(r);
    try{document.execCommand('copy');}catch(e){}
    sel.removeAllRanges();
    const btn=document.querySelector('[data-copy="'+id+'"]');
    if(btn){btn.textContent='복사됨 ✓'; setTimeout(()=>btn.textContent='복사',1200);}
  }
</script>
</head>
<body>
<header>
  <div class="inner">
    <div class="title">SERVICE 서비스 서버 API</div>
    <span class="badge">OpenAPI 3.0.0</span>
    <span class="badge">버전 2025.10.03</span>
    <a class="btn" href="#spec">원본 스펙 보기</a>
  </div>
</header>
<div class="wrap">
  <section class="card">
    <h1>SERVICE 서비스 서버 API</h1>
    <p class="kv">서버: <code>https://dev-service.com/api</code></p>
    <p>앱에서 모든 API 호출 시 아래 헤더를 반드시 포함하세요.</p>
    <table>
      <thead><tr><th>헤더</th><th>설명</th></tr></thead>
      <tbody>
        <tr><td><code>X-Service-Custom-Device-Id</code></td><td>UUID 문자열 (앱 최초 실행 시 랜덤 생성, 계속 동일)</td></tr>
        <tr><td><code>X-Service-Device-Model</code></td><td>32자 이하 문자열 (동일 단말이면 동일)</td></tr>
        <tr><td><code>X-Service-Os-Type</code></td><td><code>"iOS"</code> 또는 <code>"Android"</code></td></tr>
        <tr><td><code>X-Service-Os-Version</code></td><td>32자 이하 문자열</td></tr>
        <tr><td><code>X-Service-App-Version</code></td><td><code>x.y.z</code> (각 값 0~99 정수)</td></tr>
        <tr><td><code>Authorization</code></td><td>일부 엔드포인트에서 필요. 예: <code>Bearer myAccessToken</code></td></tr>
      </tbody>
    </table>
    <p class="foot">보안 스키마: <span class="pill">apiKey in header</span> — XServiceCustomDeviceId / XServiceDeviceModel / XServiceOsType / XServiceOsVersion / XServiceAppVersion</p>
  </section>

  <!-- TAGS -->
  <section class="grid">
    <div class="card">
      <h2>태그</h2>
      <div>
        <span class="tag">auth</span>
        <span class="tag">user</span>
        <span class="tag">terms</span>
      </div>
    </div>
    <div class="card">
      <h2>상태 코드(공통)</h2>
      <table>
        <thead><tr><th>코드</th><th>설명</th></tr></thead>
        <tbody>
          <tr><td><code>400</code></td><td>잘못된 요청</td></tr>
          <tr><td><code>401</code></td><td>토큰 만료(갱신 필요)</td></tr>
          <tr><td><code>403</code></td><td>소셜 로그인 정보가 유효하지 않음</td></tr>
          <tr><td><code>412</code></td><td>필수 약관 동의 누락/버전 불일치</td></tr>
          <tr><td><code>423</code></td><td>토큰 정보 불일치(강제 로그아웃 필요)</td></tr>
          <tr><td><code>426</code></td><td>필수 업데이트 대상(앱 업데이트 필요)</td></tr>
          <tr><td><code>500</code></td><td>서버 오류</td></tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- AUTH -->
  <section class="card">
    <h2>Auth</h2>

    <details>
      <summary><span class="method POST">POST</span> <code>/v1/auth/social</code> — 앱에서 SDK로 소셜 로그인한 정보 검증</summary>
      <div class="content">
        <p>회원가입/로그인 전에 소셜 로그인 결과를 서버로 전송하여 <b>socialUuid</b>를 발급받습니다.</p>
        <ul>
          <li>카카오: <code>socialType</code>, <code>socialAccessToken</code>, <code>socialRefreshToken</code></li>
          <li>애플: <code>socialType</code>, <code>authorizationCode</code>, <code>nonce</code>, <code>state</code></li>
          <li>네이버: <code>socialType</code>, <code>socialAccessToken</code>, <code>socialRefreshToken</code></li>
          <li>구글: 추후 명세</li>
        </ul>
        <h3>요청 바디</h3>
<pre><code class="mono">{
  "socialType": "KAKAO | APPLE | NAVER | GOOGLE",
  "socialAccessToken": "string",
  "socialRefreshToken": "string",
  "authorizationCode": "string",
  "nonce": "string",
  "state": "string"
}</code></pre>
        <h3>성공(200)</h3>
        <p><code>serviceUserId</code>가 응답에 <b>없으면</b> 미가입자 → 회원가입(flow 진행), <b>있으면</b> 기존 사용자 → 로그인(flow 진행).</p>
<pre><code class="mono">{
  "social": { "socialType": "KAKAO", "socialUuid": "827fd25a-863d-4d4d-b624-5ad55f1fa32f" },
  "serviceUserId": 1 // 기존 사용자일 때만 존재
}</code></pre>
        <h3>에러</h3>
        <ul>
          <li>403 소셜 로그인 무효</li>
          <li>426 필수 업데이트</li>
        </ul>
      </div>
    </details>

    <details>
      <summary><span class="method POST">POST</span> <code>/v1/auth/signup</code> — 회원가입(신규 사용자)</summary>
      <div class="content">
        <p>소셜 검증에서 <code>serviceUserId</code>를 받지 못한 경우(미가입자), 약관 동의/본인인증 후 호출합니다.</p>
        <h3>요청 바디</h3>
<pre><code class="mono">{
  "social": { "socialType": "KAKAO", "socialUuid": "..." },
  "termsAgreements": [ { "termsKey": "SERVICE_SERVICE_USE", "version": 1 } ],
  "identity": { "MDL_TKN": "8be1238534e34249add35f17a5b3ada3" },
  "device": { "pushTokenType": "FCM_REGISTRATION_TOKEN", "pushToken": "..." }
}</code></pre>
        <h3>성공(200)</h3>
<pre><code class="mono">{
  "serviceUserId": 1,
  "accessToken": "jwt-access",
  "refreshToken": "jwt-refresh"
}</code></pre>
        <h3>중복 가입 거절(205)</h3>
<pre><code class="mono">{
  "code": 10001,
  "message": "이미 가입했던 이력이 확인돼요.",
  "details": { "serviceUserId": 1, "socialType": "KAKAO", "email": "myid@example.com", "lastLoginDate": "2025-09-01" }
}</code></pre>
        <h3>기타</h3>
        <ul>
          <li>403 소셜 무효, 412 약관 불일치, 426 필수 업데이트</li>
        </ul>
      </div>
    </details>

    <details>
      <summary><span class="method POST">POST</span> <code>/v1/auth/login</code> — 로그인(기존 사용자)</summary>
      <div class="content">
        <p>소셜 검증에서 <code>serviceUserId</code>를 받은 경우 호출합니다.</p>
<pre><code class="mono">{
  "serviceUserId": 1,
  "social": { "socialType": "KAKAO", "socialUuid": "..." },
  "device": { "pushTokenType": "FCM_REGISTRATION_TOKEN", "pushToken": "..." }
}</code></pre>
        <h3>성공(200)</h3>
<pre><code class="mono">{
  "accessToken": "jwt-access",
  "refreshToken": "jwt-refresh"
}</code></pre>
        <p>에러: 403, 426</p>
      </div>
    </details>

    <details>
      <summary><span class="method PUT">PUT</span> <code>/v1/auth/refresh</code> — 서비스 인증 토큰 갱신</summary>
      <div class="content">
        <p>401 응답을 받은 경우 사용합니다.</p>
<pre><code class="mono">{
  "serviceUserId": 1,
  "refreshToken": "jwt-refresh"
}</code></pre>
        <h3>성공(200)</h3>
<pre><code class="mono">{
  "accessToken": "new-access",
  "refreshToken": "maybe-new-refresh" // 갱신된 경우에만 존재
}</code></pre>
        <p>에러: 423(강제 로그아웃 필요), 426</p>
      </div>
    </details>

    <details>
      <summary><span class="method DELETE">DELETE</span> <code>/v1/auth/logout</code> — 로그아웃</summary>
      <div class="content">
        <p><code>Authorization</code> 헤더 필요. 현재 디바이스 정보 삭제 및 인증 파기.</p>
        <p>성공(200) / 에러: 401, 423, 426</p>
      </div>
    </details>
  </section>

  <!-- USER -->
  <section class="card">
    <h2>User</h2>

    <details>
      <summary><span class="method GET">GET</span> <code>/v1/user</code> — 현재 사용자 정보 조회</summary>
      <div class="content">
        <p>Authorization 헤더 필요. <code>attribute</code> 쿼리로 필요한 키만 선택 조회 가능.</p>
        <p><b>attribute</b> 옵션: <code>profile</code> | <code>device</code> | <code>ageGroup</code> | <code>socialTypes</code></p>
        <h3>응답(200) 예</h3>
<pre><code class="mono">{
  "profile": {
    "nickname": "나는감자",
    "imageUrl": "https://cdn.service.com/profile/image/abcabc.jpg",
    "email": "myid@example.com",
    "district": "SEOUL",
    "interestFields": ["관심분야1","관심분야2"],
    "interestLevel": "HIGH",
    "termsAgreements": [{ "termsKey":"SERVICE_SERVICE_USE", "version":1 }]
  },
  "device": { "pushTokenType":"FCM_REGISTRATION_TOKEN","pushToken":"..." },
  "ageGroup": "20대",
  "socialTypes": ["KAKAO","APPLE"]
}</code></pre>
        <p>에러: 401, 423, 426</p>
      </div>
    </details>

    <details>
      <summary><span class="method PUT">PUT</span> <code>/v1/user</code> — 현재 사용자 정보 수정</summary>
      <div class="content">
        <p>변경할 필드만 포함하여 보냅니다.</p>
<pre><code class="mono">{
  "profile": { "nickname": "새닉네임" },
  "device": { "pushToken": "..." }
}</code></pre>
        <p>성공(200) / 에러: 401, 412, 423, 426</p>
      </div>
    </details>

    <details>
      <summary><span class="method DELETE">DELETE</span> <code>/v1/user</code> — 현재 사용자 삭제(회원탈퇴)</summary>
      <div class="content">
        <p>성공(200) / 에러: 401, 423, 426</p>
      </div>
    </details>

    <details>
      <summary><span class="method GET">GET</span> <code>/v1/user/firebase-custom-token</code> — Firebase custom token 조회</summary>
      <div class="content">
        <p>로그인 상태에서 Firebase SDK sign in이 필요할 때 사용.</p>
<pre><code class="mono">{ "firebaseCustomToken": "..." }</code></pre>
        <p>에러: 401, 423, 426</p>
      </div>
    </details>

    <details>
      <summary><span class="method GET">GET</span> <code>/v1/user/nickname-availability</code> — 닉네임 사용 가능 여부</summary>
      <div class="content">
        <p>쿼리: <code>nickname=... (URL Encoded)</code>, Authorization 필요.</p>
<pre><code class="mono">{
  "nickname": "나는감자",
  "isForbidden": false,
  "isOccupied": false
}</code></pre>
        <p>에러: 401, 423, 426</p>
      </div>
    </details>
  </section>

  <!-- TERMS -->
  <section class="card">
    <h2>Terms</h2>
    <details>
      <summary><span class="method GET">GET</span> <code>/v1/terms</code> — 약관 정보 전체 조회</summary>
      <div class="content">
<pre><code class="mono">[
  {
    "termsKey": "SERVICE_SERVICE_USE",
    "version": 1,
    "displayOrder": 1,
    "title": "서비스 이용약관",
    "content": "...",
    "contentLink": "https://... (있을 때만)",
    "isMandatory": true
  }
]</code></pre>
        <p>성공(200) / 에러: 426</p>
      </div>
    </details>
  </section>

  <!-- SCHEMAS -->
  <section class="card">
    <h2>스키마</h2>

    <details>
      <summary><code>ErrorResponse</code></summary>
      <div class="content">
        <table>
          <thead><tr><th>필드</th><th>타입</th><th>설명</th></tr></thead>
          <tbody>
            <tr><td>code</td><td>int32</td><td>에러 코드</td></tr>
            <tr><td>message</td><td>string</td><td>에러 메시지</td></tr>
            <tr><td>details</td><td>object</td><td>에러 세부(Map, 자유 형식)</td></tr>
          </tbody>
        </table>
      </div>
    </details>

    <details>
      <summary><code>Identity</code></summary>
      <div class="content">
        <table>
          <thead><tr><th>필드</th><th>타입</th><th>설명</th></tr></thead>
          <tbody>
            <tr><td>MDL_TKN</td><td>string</td><td>KCB에서 전달된 값</td></tr>
          </tbody>
        </table>
      </div>
    </details>

    <details>
      <summary><code>Terms</code></summary>
      <div class="content">
        <table>
          <thead><tr><th>필드</th><th>타입</th><th>설명</th></tr></thead>
          <tbody>
            <tr><td>termsKey</td><td>string</td><td>약관 구분자</td></tr>
            <tr><td>version</td><td>int32</td><td>현재 버전</td></tr>
            <tr><td>displayOrder</td><td>int32</td><td>노출 순서(음수=미노출)</td></tr>
            <tr><td>title</td><td>string</td><td>제목</td></tr>
            <tr><td>content</td><td>string</td><td>내용</td></tr>
            <tr><td>contentLink</td><td>string</td><td>웹뷰 링크(있을 때만)</td></tr>
            <tr><td>isMandatory</td><td>boolean</td><td>필수 여부</td></tr>
          </tbody>
        </table>
      </div>
    </details>

    <details>
      <summary><code>AgeGroup</code>, <code>InterestLevel</code></summary>
      <div class="content">
        <p><b>AgeGroup</b>: <code>18세 미만 | 10대 | 20대 | 30대 | 40대 | 50대 | 60대 | 70대 | 80대 이상</code></p>
        <p><b>InterestLevel</b>: <code>MAX | HIGH | NORMAL | LOW | MIN</code></p>
      </div>
    </details>

    <details>
      <summary><code>Profile</code></summary>
      <div class="content">
        <table>
          <thead><tr><th>필드</th><th>타입</th><th>설명</th></tr></thead>
          <tbody>
            <tr><td>nickname</td><td>string</td><td>닉네임</td></tr>
            <tr><td>imageUrl</td><td>string</td><td>프로필 이미지 URL</td></tr>
            <tr><td>email</td><td>string</td><td>이메일</td></tr>
            <tr><td>district</td><td>string</td><td>SEOUL | INCHEON | GYEONGGI | GANGWON | CHUNGCHEONG | GYEONGSANG | JEOLLA | JEJU</td></tr>
            <tr><td>interestFields</td><td>string[]</td><td>관심 분야 리스트</td></tr>
            <tr><td>interestLevel</td><td>string</td><td>MAX/HIGH/NORMAL/LOW/MIN</td></tr>
            <tr><td>termsAgreements</td><td>array</td><td>동의 약관 리스트</td></tr>
          </tbody>
        </table>
      </div>
    </details>

    <details>
      <summary><code>Device</code></summary>
      <div class="content">
        <table>
          <thead><tr><th>필드</th><th>타입</th><th>설명</th></tr></thead>
          <tbody>
            <tr><td>pushTokenType</td><td>string</td><td>FCM_REGISTRATION_TOKEN | APNS_DEVICE_TOKEN (기본: FCM_REGISTRATION_TOKEN)</td></tr>
            <tr><td>pushToken</td><td>string</td><td>필수</td></tr>
          </tbody>
        </table>
      </div>
    </details>

    <details>
      <summary><code>Social</code>, <code>SocialType</code>, <code>SocialUuid</code></summary>
      <div class="content">
        <p><b>Social</b> = { socialType: <code>SocialType</code>, socialUuid: <code>uuid</code> }</p>
        <p><b>SocialType</b>: <code>KAKAO | APPLE | NAVER | GOOGLE</code></p>
        <p><b>SocialUuid</b>: 검증 후 발급되는 UUID</p>
      </div>
    </details>

    <details>
      <summary><code>ServiceUserId</code>, <code>AccessToken</code>, <code>RefreshToken</code></summary>
      <div class="content">
        <p><b>ServiceUserId</b>: int64</p>
        <p><b>AccessToken</b>: string (만료 1시간)</p>
        <p><b>RefreshToken</b>: string (만료 90일)</p>
      </div>
    </details>
  </section>

  <!-- RAW SPEC -->
  <section id="spec" class="card">
    <h2>원본 OpenAPI 스펙 (YAML)</h2>
    <p class="kv">정적 문서입니다. 다른 도구(Redoc, Swagger UI 등)에 붙여 재사용할 수 있습니다.</p>
    <div style="display:flex;justify-content:flex-end;margin-bottom:.5rem">
      <button class="btn" data-copy="oas">복사</button>
    </div>
<pre id="oas"><code class="mono">openapi: 3.0.0
info:
  title: SERVICE 서비스 서버 API
  version: 2025.10.03
  description: |-
    SERVICE 서비스 제공을 위한 서버 API 명세 입니다.

    ---
    ## 앱에서 모든 API 호출시 필수로 포함할 헤더
      - **X-Service-Custom-Device-Id**
        - UUID 형식의 string (앱 최초 실행시 랜덤 생성 후, 항상 동일해야함)
      - **X-Service-Device-Model**
        - 32자 이하의 string (동일 단말이라면, 항상 동일해야함)
      - **X-Service-Os-Type**
        - "iOS" 또는 "Android"
      - **X-Service-Os-Version**
        - 32자 이하의 string
      - **X-Service-App-Version**
        - "x.y.z" 형태의 string (x, y, z 는 각각 99 이하의 정수)
    ---

servers:
  - url: https://dev-service.com/api

security:
  - XServiceCustomDeviceId: []
  - XServiceDeviceModel: []
  - XServiceOsType: []
  - XServiceOsVersion: []
  - XServiceAppVersion: []

tags:
  - name: auth
    description: 서비스 인증 관련 API
  - name: user
    description: 사용자 정보 관련 API
  - name: terms
    description: 약관 정보 관련 API

paths:
  /v1/auth/social:
    post:
      tags:
        - auth
      summary: 앱에서 SDK로 소셜 로그인한 정보 검증
      description: |-
        회원가입/로그인 API 호출 전, 소셜 로그인 수행 결과를 전송해서 소셜 UUID 획득 필요

        **(중요) 소셜 사이트에 따라 필수로 포함해야하는 필드가 다르므로, 스키마의 required 속성 대신 아래 설명을 참고**
          - 카카오 : socialType, socialAccessToken, socialRefreshToken
          - 애플 : socialType, authorizationCode, nonce, state
          - 네이버 : socialType, socialAccessToken, socialRefreshToken
          - 구글 : ?
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                socialType:
                  $ref: '#/components/schemas/SocialType'
                socialAccessToken:
                  type: string
                  description: 소셜 사이트에서 발급해준 엑세스 토큰
                socialRefreshToken:
                  type: string
                  description: 소셜 사이트에서 발급해준 리프레시 토큰
                authorizationCode:
                  type: string
                  description: 소셜 사이트에서 발급해준 인증 코드
                nonce:
                  type: string
                  description: 소셜 사이트 로그인 요청시 클라가 생성한 nonce 값
                state:
                  type: string
                  description: 소셜 사이트 로그인 요청시 클라가 생성한 state 값
              required:
                - socialType
      responses:
        '200':
          description: |-
            소셜 로그인 정보 저장 및 검증 성공

            **(참고) serviceUserId 필드는 이미 연동된 소셜 로그인 정보인 경우에만 포함되며, 미연동된 소셜 로그인 정보라면 serviceUserId 필드 자체가 포함되지 않음**
            - serviceUserId 필드가 **없으면** -> 약관 동의 및 본인인증 진행하고, **회원가입** 요청 필요
            - serviceUserId 필드가 **있으면** -> **로그인** 요청 필요
          content:
            application/json:
              schema:
                type: object
                properties:
                  social:
                    $ref: '#/components/schemas/Social'
                  serviceUserId:
                    $ref: '#/components/schemas/ServiceUserId'
                required:
                  - social
        '403':
          $ref: "#/components/responses/403Forbidden"
        '426':
          $ref: "#/components/responses/426UpgradeRequired"
  /v1/auth/signup:
    post:
      tags:
        - auth
      summary: 회원가입 (신규 사용자)
      description: 소셜 로그인한 정보 검증으로 serviceUserId 를 획득하지 못했다면(=미가입자), 약관 동의 및 본인인증 진행한 후에 회원가입 호출
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                social:
                  $ref: '#/components/schemas/Social'
                termsAgreements:
                  $ref: '#/components/schemas/TermsAgreements'
                identity:
                  $ref: '#/components/schemas/Identity'
                device:
                  $ref: '#/components/schemas/Device'
              required:
                - social
                - termsAgreements
                - identity
                - device
      responses:
        '200':
          description: 가입 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  serviceUserId:
                    $ref: '#/components/schemas/ServiceUserId'
                  accessToken:
                    $ref: '#/components/schemas/AccessToken'
                  refreshToken:
                    $ref: '#/components/schemas/RefreshToken'
                required:
                  - serviceUserId
                  - accessToken
                  - refreshToken
        '205':
          description: |-
            중복 가입 거절

            **(참고) 현재 소셜 계정 연동은 1개만 가능하나, 추후 이 응답은 삭제하고 멀티 연동이 가능하도록 변경 예정**
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                already_signup_ci:
                  summary: 동일한 CI로 이미 가입된 계정 정보 제공
                  value:
                    code: 10001
                    message: "이미 가입했던 이력이 확인돼요."
                    details:
                      serviceUserId: 1
                      socialType: KAKAO
                      email: myid@example.com
                      lastLoginDate: 2025-09-01
        '403':
          $ref: "#/components/responses/403Forbidden"
        '412':
          $ref: "#/components/responses/412PreconditionFailed"
        '426':
          $ref: "#/components/responses/426UpgradeRequired"
  /v1/auth/login:
    post:
      tags:
        - auth
      summary: 로그인 (기존 사용자)
      description: 소셜 로그인한 정보 검증으로 serviceUserId 를 획득했다면, 로그인 호출
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                serviceUserId:
                  $ref: '#/components/schemas/ServiceUserId'
                social:
                  $ref: '#/components/schemas/Social'
                device:
                  $ref: '#/components/schemas/Device'
              required:
                - serviceUserId
                - social
                - device
      responses:
        '200':
          description: 로그인 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    $ref: '#/components/schemas/AccessToken'
                  refreshToken:
                    $ref: '#/components/schemas/RefreshToken'
                required:
                  - accessToken
                  - refreshToken
        '403':
          $ref: "#/components/responses/403Forbidden"
        '426':
          $ref: "#/components/responses/426UpgradeRequired"
  /v1/auth/refresh:
    put:
      tags:
        - auth
      summary: 서비스 인증 토큰 갱신
      description: 엑세스 토큰 만료시(=401 응답 수신시) 호출
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                serviceUserId:
                  $ref: '#/components/schemas/ServiceUserId'
                refreshToken:
                  $ref: '#/components/schemas/RefreshToken'
              required:
                - serviceUserId
                - refreshToken
      responses:
        '200':
          description: |-
            토큰 갱신 성공

            **(참고) refreshToken 필드는 리프레시 토큰이 갱신되는 경우에만 포함되며, 갱신되지 않는 경우엔 refreshToken 필드 자체가 포함되지 않음**
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    $ref: '#/components/schemas/AccessToken'
                  refreshToken:
                    $ref: '#/components/schemas/RefreshToken'
                required:
                  - accessToken
        '423':
          $ref: "#/components/responses/423Locked"
        '426':
          $ref: "#/components/responses/426UpgradeRequired"
  /v1/auth/logout:
    delete:
      tags:
        - auth
      summary: 로그아웃
      description: 현 디바이스 정보 삭제 및 인증 파기
      parameters:
        - $ref: '#/components/parameters/AuthorizationHeader'
      responses:
        '200':
          description: 로그아웃 성공
        '401':
          $ref: "#/components/responses/401Unauthorized"
        '423':
          $ref: "#/components/responses/423Locked"
        '426':
          $ref: "#/components/responses/426UpgradeRequired"

  /v1/user:
    get:
      tags:
        - user
      summary: 현재 사용자 정보 조회
      description: 앱에서 필요한 현재 사용자 정보 조회
      parameters:
        - $ref: '#/components/parameters/AuthorizationHeader'
        - name: attribute
          description: 조회할 정보 리스트 (없으면 전부 조회)
          in: query
          style: form
          explode: true
          schema:
            type: array
            items:
              type: string
              enum:
                - profile
                - device
                - ageGroup
                - socialTypes
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  profile:
                    $ref: '#/components/schemas/Profile'
                  device:
                    $ref: '#/components/schemas/Device'
                  ageGroup:
                    $ref: '#/components/schemas/AgeGroup'
                  socialTypes:
                    type: array
                    description: 연동된 소셜 사이트 타입 리스트
                    items:
                      $ref: '#/components/schemas/SocialType'
        '401':
          $ref: "#/components/responses/401Unauthorized"
        '423':
          $ref: "#/components/responses/423Locked"
        '426':
          $ref: "#/components/responses/426UpgradeRequired"
    put:
      tags:
        - user
      summary: 현재 사용자 정보 수정
      description: 변경을 원하는 정보만 채워서 요청 (입력 안된 키 값들은 기존 정보 유지)
      parameters:
        - $ref: '#/components/parameters/AuthorizationHeader'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                profile:
                  $ref: '#/components/schemas/Profile'
                device:
                  $ref: '#/components/schemas/Device'
      responses:
        '200':
          description: 수정 성공
        '401':
          $ref: "#/components/responses/401Unauthorized"
        '412':
          $ref: "#/components/responses/412PreconditionFailed"
        '423':
          $ref: "#/components/responses/423Locked"
        '426':
          $ref: "#/components/responses/426UpgradeRequired"
    delete:
      tags:
        - user
      summary: 현재 사용자 삭제 (회원탈퇴)
      description: 사용자 및 디바이스 정보 일괄 삭제
      parameters:
        - $ref: '#/components/parameters/AuthorizationHeader'
      responses:
        '200':
          description: 탈퇴 성공
        '401':
          $ref: "#/components/responses/401Unauthorized"
        '423':
          $ref: "#/components/responses/423Locked"
        '426':
          $ref: "#/components/responses/426UpgradeRequired"
  /v1/user/firebase-custom-token:
    get:
      tags:
        - user
      summary: 현재 사용자의 Firebase custom token 조회
      description: 로그인된 상태에서 Firebase SDK에 sign in 필요할 때 호출 (응답값은 매번 바뀔 수 있으며 서버에 저장되지 않음)
      parameters:
        - $ref: '#/components/parameters/AuthorizationHeader'
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  firebaseCustomToken:
                    type: string
                required:
                  - firebaseCustomToken
        '401':
          $ref: "#/components/responses/401Unauthorized"
        '423':
          $ref: "#/components/responses/423Locked"
        '426':
          $ref: "#/components/responses/426UpgradeRequired"
  /v1/user/nickname-availability:
    get:
      tags:
        - user
      summary: 닉네임 사용 가능 여부 조회
      description: 닉네임 변경 전 검사를 위해 호출
      parameters:
        - $ref: '#/components/parameters/AuthorizationHeader'
        - name: nickname
          in: query
          schema:
            type: string
          description: 조회할 닉네임 (전송시 URL Encoding 처리 필요함에 주의)
          required: true
      responses:
        '200':
          description: 조회 성공 (isForbidden, isOccupied 값이 모두 false 일때만 사용 가능)
          content:
            application/json:
              schema:
                type: object
                properties:
                  nickname:
                    type: string
                    description: 조회한 닉네임
                  isForbidden:
                    type: boolean
                    description: 금지 여부
                    example: false
                  isOccupied:
                    type: boolean
                    description: 사용 여부
                required:
                  - nickname
                  - isForbidden
                  - isOccupied
        '401':
          $ref: "#/components/responses/401Unauthorized"
        '423':
          $ref: "#/components/responses/423Locked"
        '426':
          $ref: "#/components/responses/426UpgradeRequired"

  /v1/terms:
    get:
      tags:
        - terms
      summary: 약관 정보 조회
      description: 서비스 약관 전체 조회
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Terms'
        '426':
          $ref: "#/components/responses/426UpgradeRequired"

components:
  securitySchemes:
    XServiceCustomDeviceId:
      type: apiKey
      in: header
      name: X-Service-Custom-Device-Id
    XServiceDeviceModel:
      type: apiKey
      in: header
      name: X-Service-Device-Model
    XServiceOsType:
      type: apiKey
      in: header
      name: X-Service-Os-Type
    XServiceOsVersion:
      type: apiKey
      in: header
      name: X-Service-Os-Version
    XServiceAppVersion:
      type: apiKey
      in: header
      name: X-Service-App-Version

  parameters:
    AuthorizationHeader:
      name: Authorization
      in: header
      description: 서비스 엑세스 토큰
      required: true
      schema:
        type: string
        example: Bearer myAccessToken

  responses:
    400BadRequest:
      description: 잘못된 요청
    401Unauthorized:
      description: 토큰 만료 (토큰 갱신 필요)
    403Forbidden:
      description: 소셜 로그인이 유효하지 않음
    412PreconditionFailed:
      description: 필수 약관에 대한 동의가 누락되거나, 동의한 약관의 버전이 현재 버전과 다름
    423Locked:
      description: 토큰 정보 불일치 (강제 로그아웃 필요)
    426UpgradeRequired:
      description: 필수 업데이트 설정된 클라이언트 버전 (앱 업데이트 필요)
    500InternalServerError:
      description: 서버 오류

  schemas:
    ErrorResponse:
      type: object
      description: 서버 공통 에러 응답
      properties:
        code:
          type: integer
          format: int32
          example: 10000
        message:
          type: string
          example: "잘못된 요청입니다."
        details:
          type: object
          description: 에러 세부 내용 (Map 형태로 에러마다 달라질 수 있음)
          additionalProperties: true
          example:
            key1: "value1"
            key2: "value2"

    Identity:
      type: object
      description: 본인인증 정보
      properties:
        MDL_TKN:
          type: string
          description: 본인인증 대행사(KCB)에서 전달된 값
          example: 8be1238534e34249add35f17a5b3ada3
      required:
        - MDL_TKN
    Terms:
      type: object
      description: 약관 정보
      properties:
        termsKey:
          type: string
          description: 약관 구분자
          example: "SERVICE_SERVICE_USE"
        version:
          type: integer
          format: int32
          description: 약관의 현재 버전
        displayOrder:
          type: integer
          format: int32
          description: 약관 노출 순서 (음수인 경우 미노출 처리)
        title:
          type: string
          description: 약관 제목
        content:
          type: string
          description: 약관 내용
        contentLink:
          type: string
          description: 약관 내용을 웹뷰로 노출해야하는 경우에만 존재
        isMandatory:
          type: boolean
          description: 약관의 필수 여부 (선택 약관이면 false)
      required:
        - termsKey
        - displayOrder
        - title
        - content
        - version
        - isMandatory
    AgeGroup:
      type: string
      description: 연령대
      enum:
        - 18세 미만
        - 10대
        - 20대
        - 30대
        - 40대
        - 50대
        - 60대
        - 70대
        - 80대 이상
    TermsAgreements:
      type: array
      description: 사용자가 동의한 약관 리스트
      items:
        type: object
        description: 약관 동의 정보
        properties:
          termsKey:
            type: string
            description: 약관 구분자
            example: "SERVICE_SERVICE_USE"
          version:
            type: integer
            format: int32
            description: 동의할 당시 약관의 버전
            example: 1
        required:
          - termsKey
          - version
    Profile:
      type: object
      description: 사용자 프로필 & 추가 정보
      properties:
        nickname:
          type: string
          description: 닉네임
          example: 나는감자
        imageUrl:
          type: string
          description: 프로필 사진 URL
          example: https://cdn.service.com/profile/image/abcabc.jpg
        email:
          type: string
          description: 이메일
          example: myid@example.com
        district:
          type: string
          description: 지역구
          enum:
            - SEOUL
            - INCHEON
            - GYEONGGI
            - GANGWON
            - CHUNGCHEONG
            - GYEONGSANG
            - JEOLLA
            - JEJU
        interestFields:
          type: array
          description: 관심 분야 리스트
          items:
            type: string
            enum:
              - 분야이름1
              - 분야이름2
              - 분야이름3
              - 분야이름4
              - 분야이름5
              - 분야이름6
              - 분야이름7
        interestLevel:
          type: string
          description: 관심 수준
          enum:
            - MAX
            - HIGH
            - NORMAL
            - LOW
            - MIN
        termsAgreements:
          $ref: '#/components/schemas/TermsAgreements'
    Device:
      type: object
      description: 현 디바이스 정보
      properties:
        pushTokenType:
          type: string
          description: 푸시 토큰 타입
          default: FCM_REGISTRATION_TOKEN
          enum:
            - FCM_REGISTRATION_TOKEN
            - APNS_DEVICE_TOKEN
        pushToken:
          type: string
          description: 푸시 토큰
      required:
        - pushToken
    Social:
      type: object
      description: 소셜 로그인 검증 결과
      properties:
        socialType:
          $ref: '#/components/schemas/SocialType'
        socialUuid:
          $ref: '#/components/schemas/SocialUuid'
      required:
        - socialType
        - socialUuid
    SocialType:
      type: string
      enum:
        - KAKAO
        - APPLE
        - NAVER
        - GOOGLE
      description: 소셜 사이트 타입
      example: KAKAO
    SocialUuid:
      type: string
      description: 소셜 로그인 정보 검증 후 응답 받은 UUID 값
      example: 827fd25a-863d-4d4d-b624-5ad55f1fa32f
    ServiceUserId:
      description: 사용자 아이디
      type: integer
      format: int64
      example: 1
    AccessToken:
      description: 서비스 엑세스 토큰 (1시간 만료)
      type: string
    RefreshToken:
      description: 서비스 리프레시 토큰 (90일 만료)
      type: string
</code></pre>
  </section>

  <p class="foot">© SERVICE — 정적 미리보기</p>
</div>
<script>
  document.querySelectorAll('[data-copy]').forEach(btn=>btn.addEventListener('click',()=>copyText(btn.getAttribute('data-copy'))));
</script>
</body>
</html>